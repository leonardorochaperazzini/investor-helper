generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x", "linux-arm64-openssl-1.1.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model FinancialAssetType {
  id              Int                      @id @default(autoincrement())
  code            String                   @unique
  description     String?
  country         String?                  @map("country")
  currencyPrice   Float                    @default(1) @map("currency_price")
  financialAssets FinancialAsset[]
  investGroups    InvestGroup[]
  histories       FinancialAssetHistory[]  @relation("FinancialAssetTypeToHistory")

  @@index([code], name: "idx_financial_asset_type_code")
  @@map("financial_asset_type")
}

model InvestGroup {
  id                 Int                @id @default(autoincrement())
  typeId             Int                @map("type_id")
  desiredPercentageValue       Float?             @map("desired_percentage_value")
  financialAssetType FinancialAssetType @relation(fields: [typeId], references: [id])
  financialAssets    FinancialAsset[]

  @@index([typeId], name: "idx_invest_group_type_id")
  @@map("invest_group")
}

model FinancialAsset {
  id                 Int                @id @default(autoincrement())
  code               String             @unique
  description        String?
  desiredPercentageValue       Float?             @map("desired_percentage_value")
  currentMarketValue Float?             @map("current_market_value")
  amount             Float?             @map("amount")
  typeId             Int                @map("type_id")
  groupId            Int?               @map("group_id")

  financialAssetType FinancialAssetType @relation(fields: [typeId], references: [id])
  investGroup        InvestGroup?       @relation(fields: [groupId], references: [id])

  @@index([code], name: "idx_financial_asset_code")
  @@index([typeId], name: "idx_financial_asset_type_id")
  @@index([groupId], name: "idx_financial_asset_group_id")
  @@map("financial_asset")
}

model FinancialAssetHistory {
  id                 Int                 @id @default(autoincrement())
  code               String
  desiredPercentageValue       Float?              @map("desired_percentage_value")
  marketValue        Float?              @map("market_value")
  amount             Float?              @map("amount")
  typeCode           String?             @map("type_code")
  groupdesiredPercentageValue  Float?              @map("group_desired_percentage_value")
  insertedDate       DateTime            @default(now()) @map("inserted_date") @db.Date

  financialAssetType FinancialAssetType? @relation("FinancialAssetTypeToHistory", fields: [typeCode], references: [code])

  @@index([code], name: "idx_financial_asset_history_code")
  @@index([insertedDate], name: "idx_financial_asset_history_inserted_date")
  @@index([typeCode], name: "idx_financial_asset_history_type_code")
  @@unique([code, insertedDate])
  @@map("financial_asset_history")
}
